# CodeStructView 项目结构

## 目录结构

```
CodeStructView/
├── src/                              # 源代码目录
│   ├── extension.ts                  # 扩展主入口文件
│   │   └── 功能：扩展激活/停用、注册命令和事件监听
│   └── codeStructViewProvider.ts     # 代码结构视图提供者
│       └── 功能：实现树视图和 Webview 面板的数据提供
├── out/                              # 编译输出目录（自动生成）
│   ├── extension.js                  # 编译后的主入口文件
│   └── codeStructViewProvider.js     # 编译后的视图提供者文件
├── node_modules/                     # 依赖包目录（npm install 后生成）
├── package.json                      # 扩展配置文件
│   └── 包含：扩展元数据、命令定义、视图配置、菜单配置
├── tsconfig.json                     # TypeScript 编译配置
├── .gitignore                        # Git 忽略文件配置
├── .vscodeignore                     # VSCode 扩展打包忽略配置
├── README.md                         # 项目说明文档（中文）
├── README.en.md                      # 项目说明文档（英文）
└── 项目结构.md                       # 本文件

```

## 文件说明

### 核心文件

#### `src/extension.ts`
- **作用**：扩展的主入口文件
- **主要功能**：
  - `activate()`: 扩展激活时调用，注册所有功能
  - `deactivate()`: 扩展停用时调用，清理资源
  - 创建树视图实例
  - 注册命令（显示面板、刷新）
  - 监听编辑器切换和文档变化事件

#### `src/codeStructViewProvider.ts`
- **作用**：代码结构视图的数据提供者
- **主要类**：
  - `CodeStructItem`: 树节点数据类
  - `CodeStructViewProvider`: 实现 `TreeDataProvider` 接口
- **主要功能**：
  - 获取当前文件的代码结构
  - 将符号信息转换为树节点
  - 管理 Webview 面板的创建和更新
  - 生成面板的 HTML 内容

### 配置文件

#### `package.json`
- **作用**：VSCode 扩展的配置文件
- **关键配置**：
  - `contributes.views`: 定义活动栏视图
  - `contributes.commands`: 定义扩展命令
  - `contributes.menus`: 定义菜单项
  - `main`: 指定扩展入口文件
  - `activationEvents`: 定义激活事件

#### `tsconfig.json`
- **作用**：TypeScript 编译配置
- **配置项**：
  - `target`: 编译目标版本
  - `module`: 模块系统
  - `outDir`: 输出目录
  - `rootDir`: 源代码根目录

### 其他文件

#### `.gitignore`
- 忽略编译输出、依赖包等文件

#### `.vscodeignore`
- 打包扩展时忽略的文件和目录

## 工作流程

1. **扩展激活**：
   - VSCode 加载扩展
   - 调用 `activate()` 函数
   - 创建视图提供者实例
   - 注册树视图和命令

2. **显示代码结构**：
   - 用户打开代码文件
   - 视图提供者获取文档符号
   - 转换为树节点显示在活动栏

3. **打开面板**：
   - 用户点击视图标题栏按钮
   - 执行 `showPanel` 命令
   - 创建或显示 Webview 面板
   - 更新面板内容

4. **实时更新**：
   - 监听编辑器切换事件
   - 监听文档变化事件
   - 自动刷新视图和面板

## 扩展点

### 可扩展功能

1. **支持更多语言**：
   - 当前使用 VSCode 内置的符号提供者
   - 可以添加特定语言的解析逻辑

2. **嵌套结构显示**：
   - 当前只显示一级符号
   - 可以扩展支持多级嵌套

3. **过滤和搜索**：
   - 添加搜索功能
   - 按类型过滤符号

4. **自定义样式**：
   - 优化面板样式
   - 支持主题切换

5. **导出功能**：
   - 导出代码结构为 JSON/XML
   - 生成文档

## 依赖说明

### 开发依赖

- `@types/vscode`: VSCode API 类型定义
- `@types/node`: Node.js 类型定义
- `typescript`: TypeScript 编译器

### 运行时依赖

- VSCode API（内置）
- Node.js（VSCode 内置）

